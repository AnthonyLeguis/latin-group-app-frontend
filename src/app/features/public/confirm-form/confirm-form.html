<div class="confirm-container">
    <!-- Loading State -->
    <div class="card loading-card hidden" [class.hidden]="!loading">
        <div class="spinner"></div>
        <p>Cargando informaci√≥n...</p>
    </div>

    <!-- Error State -->
    <div class="card error-card" [class.hidden]="loading || !error || success">
        <div class="icon error-icon">‚ùå</div>
        <h2>{{ tokenExpired ? 'Enlace Expirado' : (alreadyConfirmed ? 'Ya Confirmado' : 'Error') }}</h2>
        <p>{{ error }}</p>
        <button class="btn btn-primary" (click)="router.navigate(['/home'])">
            üè† Ir al inicio
        </button>
    </div>

    <!-- Success State -->
    <div class="card success-card" [class.hidden]="loading || (!success && error) || !success">
        <div class="icon success-icon">‚úÖ</div>
        <h2>¬°Confirmaci√≥n Exitosa!</h2>
        <p *ngIf="!error">Gracias por confirmar su informaci√≥n. Su agente ha sido notificado y se pondr√° en contacto con
            usted pronto.
        </p>
        <p *ngIf="error">{{ error }}</p>
        <div class="confirmation-date" [class.hidden]="!formData?.confirmed_at">
            <span>‚è∞ Confirmado el {{ formatDate(formData?.confirmed_at) }}</span>
        </div>
    </div>

    <!-- Form Data Display -->
    <div class="card form-card" [class.hidden]="loading || error || success || !formData">
        <div class="document-content">
            <div class="document-header">
                <img src="images/logo.png" alt="Latin Group Insurance Logo" class="company-logo">
            </div>

            <p class="greeting">Estimado Sr/a.</p>

            <div class="client-info">
                <p><strong>Nombre y apellido:</strong> {{ formData?.client_name }}</p>
                <p><strong>Fecha de Nacimiento:</strong> {{ formData?.dob }}</p>
                <p><strong>Correo Electr√≥nico:</strong> <a [href]="'mailto:' + formData?.email"> {{ formData?.email
                        }}</a>
                </p>
                <p><strong>N√∫mero de Tel√©fono:</strong> {{ formData?.phone }}</p>
                <p *ngIf="formData?.final_cost"><strong>Salario Promedio Mensual:</strong> {{ formData?.final_cost }}
                </p>
                <p *ngIf="formData?.insurance_plan"><strong>Plan 2025:</strong> {{ formData?.insurance_plan }}</p>
                <p *ngIf="formData?.state"><strong>Estado:</strong> {{ formData?.state }}</p>
            </div>

            <div class="document-text">
                <p>Le enviamos este mensaje en nombre de <strong>Latin Group Insurance</strong> para confirmar su
                    autorizaci√≥n al Asesor <strong>{{ formData?.agent_name || 'su asesor' }}</strong> a trabajar con el
                    NPN 19903181 / 19606203.
                    De <strong>{{ formData?.client_name }}</strong> para acceder y utilizar la informaci√≥n confidencial
                    que
                    usted ha proporcionado para el per√≠odo 2025. Cabe destacar que la explicaci√≥n de su plan ya ha sido
                    completada y verificada tanto por usted como por su asesor.</p>

                <p *ngIf="formData?.insurance_plan">Su plan para el a√±o 2025 es: <strong>{{ formData?.insurance_plan
                        }}</strong>.</p>

                <p>La informaci√≥n recibida por usted ser√° exclusivamente usada por una o m√°s de las siguientes razones:
                </p>

                <ul class="reasons-list">
                    <li>Consultar una aplicaci√≥n existente en el Mercado de Seguros.</li>
                    <li>Completar una solicitud para determinar su elegibilidad e inscripci√≥n en un Plan de Salud
                        Calificado del Mercado.</li>
                    <li>Brindar asistencia continua en la administraci√≥n de su cuenta y proceso de inscripci√≥n, seg√∫n
                        sea necesario.</li>
                    <li>Responder a consultas del Mercado relacionadas con su aplicaci√≥n.</li>
                </ul>

                <p>Entiendo que los agentes mencionados no utilizar√°n ni compartir√°n mi informaci√≥n personal para fines
                    distintos a los especificados anteriormente. Asimismo, se comprometen a mantener la confidencialidad
                    y
                    seguridad de mi informaci√≥n en todo momento.</p>

                <p class="confirmation-request">Si est√° de acuerdo con lo anterior, le pedimos que confirme su
                    Informaci√≥n</p>
            </div>

            <div class="button-container">
                <button class="btn btn-confirm" (click)="confirmDocument()" [disabled]="confirming">
                    <span class="spinner-small" *ngIf="confirming"></span>
                    {{ confirming ? 'CONFIRMANDO...' : 'ACEPTAR DOCUMENTO' }}
                </button>
            </div>

            <div class="footer">
                <p>Atentamente,</p>
                <p><strong>Latin Group Insurance</strong></p>
                <p class="ip-info" *ngIf="formData?.id">IP: 153.33.203.103</p>
                <p class="sent-from">Sent from <a href="https://latingroupcorp.com"
                        target="_blank">latingroupcorp.com</a></p>
            </div>
        </div>
    </div>
</div>