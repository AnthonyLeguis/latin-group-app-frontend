<div class="change-password-container">
    <mat-card class="password-card">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>lock</mat-icon>
                Cambiar Contraseña
            </mat-card-title>
            <mat-card-subtitle>
                Actualiza tu contraseña de forma segura
            </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="password-form">

                <!-- Contraseña Actual -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Contraseña Actual</mat-label>
                    <input matInput [type]="hideCurrentPassword ? 'password' : 'text'"
                        formControlName="current_password" placeholder="Ingresa tu contraseña actual" required>
                    <mat-icon matPrefix>lock_open</mat-icon>
                    <button mat-icon-button matSuffix type="button" (click)="hideCurrentPassword = !hideCurrentPassword"
                        [attr.aria-label]="'Ocultar contraseña'" [attr.aria-pressed]="hideCurrentPassword">
                        <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                    <mat-error *ngIf="passwordForm.get('current_password')?.invalid">
                        {{ getErrorMessage('current_password') }}
                    </mat-error>
                </mat-form-field>

                <!-- Nueva Contraseña -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Nueva Contraseña</mat-label>
                    <input matInput [type]="hideNewPassword ? 'password' : 'text'" formControlName="new_password"
                        placeholder="Ingresa tu nueva contraseña" required>
                    <mat-icon matPrefix>lock</mat-icon>
                    <button mat-icon-button matSuffix type="button" (click)="hideNewPassword = !hideNewPassword"
                        [attr.aria-label]="'Ocultar contraseña'" [attr.aria-pressed]="hideNewPassword">
                        <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                    <mat-hint>Mínimo 8 caracteres</mat-hint>
                    <mat-error *ngIf="passwordForm.get('new_password')?.invalid">
                        {{ getErrorMessage('new_password') }}
                    </mat-error>
                </mat-form-field>

                <!-- Confirmar Nueva Contraseña -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Confirmar Nueva Contraseña</mat-label>
                    <input matInput [type]="hideConfirmPassword ? 'password' : 'text'"
                        formControlName="new_password_confirmation" placeholder="Confirma tu nueva contraseña" required>
                    <mat-icon matPrefix>lock</mat-icon>
                    <button mat-icon-button matSuffix type="button" (click)="hideConfirmPassword = !hideConfirmPassword"
                        [attr.aria-label]="'Ocultar contraseña'" [attr.aria-pressed]="hideConfirmPassword">
                        <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                    <mat-error *ngIf="passwordForm.get('new_password_confirmation')?.invalid">
                        {{ getErrorMessage('new_password_confirmation') }}
                    </mat-error>
                </mat-form-field>

                <!-- Información de seguridad -->
                <div class="security-info">
                    <mat-icon>info</mat-icon>
                    <div class="info-text">
                        <p><strong>Requisitos de la contraseña:</strong></p>
                        <ul>
                            <li>Mínimo 8 caracteres</li>
                            <li>La nueva contraseña debe ser diferente a la actual</li>
                            <li>Por seguridad, cerrarás sesión en todos tus dispositivos</li>
                        </ul>
                    </div>
                </div>

                <!-- Botones -->
                <div class="form-actions">
                    <button mat-raised-button type="button" (click)="passwordForm.reset()" [disabled]="loading">
                        <mat-icon>clear</mat-icon>
                        Limpiar
                    </button>

                    <button mat-raised-button color="primary" type="submit"
                        [disabled]="loading || passwordForm.invalid">
                        <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
                        <mat-icon *ngIf="!loading">check_circle</mat-icon>
                        <span *ngIf="!loading">Cambiar Contraseña</span>
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</div>