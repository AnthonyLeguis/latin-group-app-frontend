<div class="create-client-container">
    <!-- Skeleton durante inicialización -->
    <app-form-skeleton *ngIf="isInitializing"></app-form-skeleton>

    <!-- Formulario real después de inicialización -->
    <mat-card class="create-client-card" *ngIf="!isInitializing">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>person_add</mat-icon>
                Ingresar Nuevo Cliente
            </mat-card-title>
            <mat-card-subtitle>
                {{ isAdmin ? 'Complete el formulario para registrar un nuevo cliente' : 'Registre un nuevo cliente
                asociado a su cuenta' }}
            </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="clientForm" (ngSubmit)="onSubmit()" class="client-form">

                <!-- Nombre completo -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Nombre Completo</mat-label>
                    <input matInput formControlName="name" placeholder="Ej: Juan Pérez" required
                        (input)="onNameInput()">
                    <mat-icon matPrefix>person</mat-icon>
                    <mat-error *ngIf="clientForm.get('name')?.invalid">
                        {{ getErrorMessage('name') }}
                    </mat-error>
                </mat-form-field>

                <!-- Email -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Correo Electrónico</mat-label>
                    <input matInput type="email" formControlName="email" placeholder="cliente@ejemplo.com" required
                        (input)="onEmailInput()">
                    <mat-icon matPrefix>email</mat-icon>
                    <mat-error *ngIf="clientForm.get('email')?.invalid">
                        {{ getErrorMessage('email') }}
                    </mat-error>
                </mat-form-field>

                <!-- Agente (solo visible para admin) -->
                <mat-form-field appearance="outline" class="full-width" *ngIf="isAdmin">
                    <mat-label>Asignar Agente</mat-label>
                    <mat-select formControlName="agent_id" required>
                        <mat-option *ngFor="let agent of agents" [value]="agent.id">
                            {{ agent.name }} ({{ agent.email }})
                        </mat-option>
                    </mat-select>
                    <mat-icon matPrefix>assignment_ind</mat-icon>
                    <mat-error *ngIf="clientForm.get('agent_id')?.invalid">
                        Debe seleccionar un agente
                    </mat-error>
                </mat-form-field>

                <!-- Info de contraseña por defecto -->
                <div class="password-info">
                    <mat-icon>info</mat-icon>
                    <span>
                        La contraseña por defecto será: <strong>latin1234*</strong>
                        <br>
                        <small>El cliente podrá cambiarla después de su primer acceso</small>
                    </span>
                </div>

                <!-- Botones -->
                <div class="form-actions">
                    <button mat-raised-button type="button" (click)="clientForm.reset(); initForm()"
                        [disabled]="loading">
                        <mat-icon>clear</mat-icon>
                        Limpiar
                    </button>

                    <button mat-raised-button color="primary" type="submit" [disabled]="loading || clientForm.invalid">
                        <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
                        <mat-icon *ngIf="!loading">save</mat-icon>
                        <span *ngIf="!loading">Crear Cliente</span>
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</div>